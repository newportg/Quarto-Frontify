[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Frontify Service",
    "section": "",
    "text": "1 Introduction and Goals",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction and Goals</span>"
    ]
  },
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "Frontify Service",
    "section": "1.1 Overview",
    "text": "1.1 Overview\nToday Marcomms manage marketing and brand across the comapny, its subsidiaries and affiliates. The IT systems employed within Marcoms have organically grown over many years, with technologies chosen to meet specific needs at the time rather than aligned to a technology strategy or assessed on a strategic fitness level of the companies IT. Often technology choices were made with a UK-first approach, and therefore some of these solutions impair Marcoms when attempting to offer global services within different territories. Some of these solutions have also poor user experiences, which cause friction for those employed to use these technologies on a day-to-day basis.\n\n\n\n\n\nAs a result, the companies marketing eco-system is disparate and poorly integrated, with poor usability and lacking the ability to centralise and manage brand and content globally.\nThe Marcoms vision is to start to unify services together, starting with a common production platform where digital assets and brands can be centrally managed and pushed out globally. Marcoms has selected a third-party platform (Frontify) to deliver this capability.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction and Goals</span>"
    ]
  },
  {
    "objectID": "index.html#goals",
    "href": "index.html#goals",
    "title": "Frontify Service",
    "section": "1.2 Goals",
    "text": "1.2 Goals\nThe goal of this phase of the implementation is integrate Frontify with the sales platform so that, we can replace Drag and Drop with this new unified service. It is proposed to offer 2 separate solutions to the sales platform users.\n\nA automated quick brochure generator that has a prescribed approach on how to present documents and images to the service.\n\nIdeal generate a email quality brochure, so we can get to market quickly.\n\nA bespoke option which will allow the users to modify and manipulate the brochures within Frontify.\n\nThis will generate a print quality brochure, aimed at more selective clients, but will take longer and involve manual manipulation of the brochures content.\n\n\nThere is also the option of performing both brochure operations if need be.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction and Goals</span>"
    ]
  },
  {
    "objectID": "Book/architectural-constraints/index.html",
    "href": "Book/architectural-constraints/index.html",
    "title": "2  Architectural Constraints",
    "section": "",
    "text": "2.1 Architectural Goals\nIntegration Goals with Frontify Marketing material services:",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Architectural Constraints</span>"
    ]
  },
  {
    "objectID": "Book/architectural-constraints/index.html#architectural-goals",
    "href": "Book/architectural-constraints/index.html#architectural-goals",
    "title": "2  Architectural Constraints",
    "section": "",
    "text": "Standardise Brochure Generation:\n\nImplement consistent methods for creating brochures.\n\nStandardise Data Integration, Reporting, and Export:\n\nEnsure uniform approaches for data handling and reporting.\n\nUtilise Current Patterns for Gathering Usage Information:\n\nAdopt existing methods to collect and analyze usage data.\n\nReduce Brochure Generation Time:\n\nStreamline processes to create brochures more quickly.\n\nControl Brochure Look and Feel with Marketing Templates:\n\nMaintain a consistent design using marketing-approved templates.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Architectural Constraints</span>"
    ]
  },
  {
    "objectID": "Book/architectural-constraints/index.html#architectural-principles",
    "href": "Book/architectural-constraints/index.html#architectural-principles",
    "title": "2  Architectural Constraints",
    "section": "2.2 Architectural Principles",
    "text": "2.2 Architectural Principles\nThe proposed pattern architecture aligns to our current Group Technology Principles as follows:\n\n\n\n\n\n\n\n\n\n#\nPrinciple\nDescription\nRAG\n\n\n\n\n1\nCloud-First and Microsoft-Considered Strategy\nThis service, like all services defined are written to take advantages of cloud-first design, and are only cloud vendor specific where they need to be.\nGreen\n\n\n2\nDesign in a modular way and think of re-use\nThe service integration pattern follows previously defined services, and shares many components.\nGreen\n\n\n3\nHigh Cohesion and Low Coupling – Favour Asynchronous Communication​\nThis service utilises a service-bus architecture, decoupling it from specific client applications, enabling it to be used by all.\nGreen\n\n\n4\nSoftware Should be Verifiable\nThis service has been designed with the view that all components will be highly testable, and fully meet the requirements of a CI/CD strategy.\nGreen\n\n\n5\nThink Global, Build Local\nThis service has been specified to be location agnostic.\nGreen\n\n\n6\nConfiguration over Customisation\nAny cloud service must facilitate run-time behaviour (configuration) changes via a self-serve administrator portal. This SAD includes the resources to enable this capability by default\nGreen\n\n\n7\nBuild with Privacy-as-Default with a risk-based approach to security\nThe pattern architecture will mandate a standards-based approach to resource authentication (Managed Identity), user authorisation (role-based access control) and both user and system activity auditing\nGreen",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Architectural Constraints</span>"
    ]
  },
  {
    "objectID": "Book/architectural-constraints/index.html#architecture-constraints",
    "href": "Book/architectural-constraints/index.html#architecture-constraints",
    "title": "2  Architectural Constraints",
    "section": "2.3 Architecture Constraints",
    "text": "2.3 Architecture Constraints\n\nExternal generation of marketing material should follow standard security and access rules concerning all clients, and especially clients with restricted access, such as high net worth and clients with NDA’s\nMarketing material should not persist on external sites longer than is necessary to complete the task.\n\nThis is to avoid possible security leaks\nMinimise storage costs\n\nAccess to the service will follow current approved security and access rules.\n\nManaged Identity to provide resource access.\nUser Identity optional, as calling systems will have already authenticated the user.\n\nIf User Identity is passed then it should be validated.\n\nUser Identity to satisfy audit.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Architectural Constraints</span>"
    ]
  },
  {
    "objectID": "Book/architectural-constraints/index.html#technical-constraints",
    "href": "Book/architectural-constraints/index.html#technical-constraints",
    "title": "2  Architectural Constraints",
    "section": "2.4 Technical Constraints",
    "text": "2.4 Technical Constraints\n\n\n\n\n\n\n\n\n\nConstraint Background and / or motivation\nSoftware and programming constraints\n\n\n\n\nCode Constraints\n\n\n\n\nTC1\nImplementation in C#\nThe application will be written/maintained in the current version of C#\n\n\nTC2\n.Net Framework\nThe application will use the current LTS version of .Net\n\n\nTC3\nThis Party Libraries\nAny third party library needs to be approved, and have the appropriate Open Source license.\n\n\nOperating System Constraints\n\n\n\n\nTC4\nCloud Provider\nThe application will be deployed to the Microsoft Azure Cloud\n\n\nTC5\nOS Development\nThe application developed for the windows platform",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Architectural Constraints</span>"
    ]
  },
  {
    "objectID": "Book/architectural-constraints/index.html#approved-pattern-architecture-documents-pad",
    "href": "Book/architectural-constraints/index.html#approved-pattern-architecture-documents-pad",
    "title": "2  Architectural Constraints",
    "section": "2.5 Approved Pattern Architecture Documents (PAD)",
    "text": "2.5 Approved Pattern Architecture Documents (PAD)\n\n\n\nPad\nApproved\n\n\n\n\nThird Party Integration\nPAD-Third Party Integrations.docx\n\n\nManaged Identities\nManaged Identities.docx\n\n\nAPIM\nAPIM.docx\n\n\nWebHooks\nWebhooks.docx\n\n\nAzure Functions\nAzureFunctions.docx\n\n\nTenant, Subscribers and Resource\nTenantsSubscriptionsAndResourceGroups.docx\n\n\nGroups\n\n\n\nCustomer Insights Data Pipeline\nCustomer Insights to Hub Data Pipeline SAD v1.0.docx",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Architectural Constraints</span>"
    ]
  },
  {
    "objectID": "Book/system-scope-and-context/index.html",
    "href": "Book/system-scope-and-context/index.html",
    "title": "3  System Scope and Context",
    "section": "",
    "text": "3.1 Business Context\nA internal user will have the ability to pass property, text and image information, to this service and receive a brochure that complies with our current marketing guidelines. The user will also have the ability to specify if they want the brochure to be autogenerated or created by hand. The quality and speed being a trade off the transaction owner will have to make. The MarComm(marketing and communications) department will create brochure templates and maintain them to the current standards.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>System Scope and Context</span>"
    ]
  },
  {
    "objectID": "Book/system-scope-and-context/index.html#technical-context",
    "href": "Book/system-scope-and-context/index.html#technical-context",
    "title": "3  System Scope and Context",
    "section": "3.2 Technical Context",
    "text": "3.2 Technical Context\n\n\nThe API runs as a microservice on our cloud platform, and will be accessible via a API Management interface.\nThe connection to the external Address provider is over HTTPS, secured by OAuth2.\nThe data passed in this application is not sensitive and doesn’t need any encryption protocols.\nAny data retuned by the external provider will be stored, by our document management and scanned for viruses.\nA service bus interface will be available, for asynchronous queueing of jobs.\nA http interface will be available, for ad-hoc querying of information.\n\n\n\n\nBusiness Interface\nChannel\n\n\n\n\nAPI for business functions\ninternet (https)\n\n\nAPI for admin / audit\ninternet (https)\n\n\nBulk Updates\nService Bus",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>System Scope and Context</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/building-block-view/index.html",
    "href": "Book/building-block-view/building-block-view/index.html",
    "title": "Building Block View",
    "section": "",
    "text": "Contained Building Blocks\nThis service has been designed to handle the interaction with the Frontify brochure generation service. Based on the information supplied the service will determine whether to use the, more automated API service, or the more bespoke CSV file service, which requires a great deal of user interaction.\nThe service will provide auditing information, which will return information based on the quantity of requests by day/month, and by whom.",
    "crumbs": [
      "Building Block View"
    ]
  },
  {
    "objectID": "Book/building-block-view/building-block-view/index.html#components",
    "href": "Book/building-block-view/building-block-view/index.html#components",
    "title": "Building Block View",
    "section": "Components",
    "text": "Components\nThe component libraries should be general and built so they can be copied or included in other projects.\n\nSecurity Component\nThis component will validate the Managed Identity Header. This indicates that the calling application has been authorised to use this service. If a caller fails the Managed Identity authorisation then the method should return a HTTP Status of 401 Unauthorised. If a user token is included, then it should be validated with Entra Id(Active Directory) and the returned claims inspected. Failure should result in a HTTP Status 403 Forbidden.\n\n\nAudit Component\nGenerally all audit components will implement the same API calls, this will allow an admin application to produced consistent reporting across the service estate. The Audit component can supply additional API methods to return specific information that only applies to the current service. The audit interface should be included with the service API, and include calls to return counts based on usage by user/system.\n\n\nCosmos Db Component\nThis component should utilise the CQRS pattern, All read requests should be serviced by Azure Search queries. Cosmos Db should be implemented with the NoSQL container. This component should use both the Microsoft.Azure.Cosmos and Azure.Identity libraries. The calling client application will be authorised by Managed Identity to access the Cosmos DB. This component should encapsulate any company nuances which are general to our usage of Cosmos DB, such as naming conventions or setting configuration.\n\n\nFrontfy Service Handler\nThis service handler will interact with the Frontify Brochure Generation system. All data will be passed to/from this service in a canonical form, so internal systems are not dependant on changes to the Frontify service.\n\n\nDomain Logic Component\nThe domain logic component implements the business requirements of the service. It consists of a workflow and rules. Workflow will not contain rules. The workflow will only ever ask questions of the rules.\n\n\nSequence of Interactions\nThe sequence diagram below shows the flow calls to Frontify.\nThe group in red is an area of discussion, as this is the manual, bespoke, process, so the service will not be able to track changes or completion. Meaning the incomplet objects in the datastore will keep building, making the CSV larger and larger.\n\n\n\nFlowchart\n\n\n\nComponent Detail\n\nAzure Function Detail\nSecurity Component\nService Component\nDomain Logic Component\nCosmos DB Component",
    "crumbs": [
      "Building Block View"
    ]
  },
  {
    "objectID": "Book/building-block-view/azure-function-detail/index.html",
    "href": "Book/building-block-view/azure-function-detail/index.html",
    "title": "4  Azure Function Detail",
    "section": "",
    "text": "[[TOC]]\n\n4.0.1 Azure Function\n\n\n4.0.1.1 RESTFul API\nBrochure\nGet Templates\n\nReturns a list of templates\nFlow\n\n\n\nURL : /Templates\nParameters : None\nHTTP Method : GET\nRequest Body : None\nResponse Body\nHTTP Errors\n\n\n\nError\nMeaning\n\n\n\n\n2xx\nOK(Success)\n\n\n4xx\nUser Failure\n\n\n5xx\nSystem Failure\n\n\n\nResponse Body\n\n\nN.B. The Details array forms the Details array of the brochure request.\nComplete Brochure\n\n\n\n\nURL\n/CompleteBrochure\n\n\n\nParameters\n\n\n\n\n\nExternalId\nId of the calling system\n\n\nHTTP Method\nGET\n\n\n\nRequest Body\nNone\n\n\n\nResponse Body\nNone\n\n\n\nHTTP Errors\n2xx\nOK(Success)\n\n\n\n4xx\nUser Failure\n\n\n\n5xx\nSystem Failure\n\n\n\nAudit\nGet By Source App\n\nReturns the count of requests made by source Application\nURL /SourceApp/\nHTTP Method GET\nParameters\n\nNone - returns an list of source apps and there counts\nSourceApp - returns the count made by the passed SourceApp\n\nRequest Body None\nResponse Body\n\n\n\nHTTP Errors\n\n\n\nError\nMeaning\n\n\n\n\n2xx\nOK(Success)\n\n\n4xx\nUser Failure\n\n\n5xx\nSystem Failure\n\n\n\n\nGet By User\n\nReturns the count of requests made by User\nURL /User/ param / (optional) Detail\nHTTP Method GET\nParameters\n\nNone - returns an list of User and their counts\n\nCannot add detail\n\nId** - returns the count made by the passed User\nLogin - returns the count made by the passed User\nEmail - returns the count made by the passed User\n\nRequest Body None\nResponse Body\n\nCount Response\n\n\n\n\nDetail response\n\n\n\nHTTP Errors\n\n\n\nError\nMeaning\n\n\n\n\n2xx\nOK(Success)\n\n\n4xx\nUser Failure\n\n\n5xx\nSystem Failure\n\n\n\n\nGet By Impersonating\n\nReturns the count of requests made by Impersonating\nURL /Impersonating/ param / (optional) Detail\nHTTP Method GET\nParameters\n\nNone - returns an list of Impersonating and their counts\n\nCannot add detail\n\nId - returns the count made by the passed Impersonating\nLogin - returns the count made by the passed Impersonating\nEmail - returns the count made by the passed Impersonating\n\nRequest Body None\nResponse Body\n\nCount Response\n\n\n\n\nDetail response\n\n\n\nHTTP Errors\n\n\n\nError\nMeaning\n\n\n\n\n2xx\nOK(Success)\n\n\n4xx\nUser Failure\n\n\n5xx\nSystem Failure\n\n\n\n\nGet By Host\n\nReturns the count of requests made by Host\nURL /Host/ param / (optional) Detail\nHTTP Method GET\nParameters\n\n\n\nParameter\nDescription\nDetail\n\n\n\n\nNone\nReturns an list of Host and their count\n\n\n\nIpAddress\nReturns the count made by the passed Host\nOptional\n\n\nhostName\nReturns the count made by the passed Host\nOptional\n\n\n\nRequest Body None\nErrors\n\n\n\nHttp Status Code\nMeaning\n\n\n\n\n200(OK)\nSuccess\n\n\n4xx\nUser request error\n\n\n5xx\nSystem Error\n\n\n\nResponse Body\n\n\n\n\n\n\n\n\nPath\nType\nDescription\n\n\n\n\nHost.IpAddress\nstring&lt;ipAddress&gt;\nThe Ip Address of the requesting host\n\n\nHost.hostName\nstring\nThe name of the requesting host\n\n\nCount\nstring&lt;number&gt;\nThe total number of requests made\n\n\nRequests\nArray\n\n\n\nRequests[].Id\nstring&lt;uuid&gt;\nId of the request\n\n\nRequests[].When\nstring&lt;DateTime&gt;\nWhen the request was made\n\n\nRequests[].Sourced\nstring\nExt/Int, was it a external or internal request\n\n\n\n\nCount Response\n\n\n\n*   Detail response\n\n\n\n4.0.1.2 Service Bus\nRequest\n\n\n\n\n\n\n\n\n\n\nColumn\nM/O\nType\nDescription\n\n\n\n\nId\nM\nGuid\nUnique identifier\n\n\nCustom\nM\nBoolean\nGenerate a custom brochure (manual)\n\n\nTemplateId\nO\nstring\nId of the template stored in the Frontify system\n\n\nBrochure\nM\n\nArray of Key/Value pairs which make up the body of the brochure.\n\n\n\n\n\n- If the Type is TEXT then value is normal text\n\n\n\n\n\n- If the Type is IMAGE then value is could be :-\n\n\n\n\n\n- GUID then get the image from the DM\n\n\n\n\n\n- Base64 string, it is the image\n\n\n\n\n\n- path then get the image from the OG hub storage (maybe)\n\n\nAudit\nM\n\nCommon Audit information supplied to all services\n\n\n\nResponse",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Azure Function Detail</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/cosmos-db-component/index.html",
    "href": "Book/building-block-view/cosmos-db-component/index.html",
    "title": "5  Cosmos Db Component",
    "section": "",
    "text": "5.1 Containers\nA NoSql Cosmos DB container should be used as this service is similar in operation to other services, and also due to the variable length of Brochure array.",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Cosmos Db Component</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/domain-logic-component/index.html",
    "href": "Book/building-block-view/domain-logic-component/index.html",
    "title": "6  Domain Logic Component",
    "section": "",
    "text": "6.1 Flowchart\nThe domain logic will handle requests from both Service Bus and Ad-hoc via a RESTful API interface. Audit enquires will be routed to the audit component.",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Domain Logic Component</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/domain-logic-component/index.html#schemas-and-maps",
    "href": "Book/building-block-view/domain-logic-component/index.html#schemas-and-maps",
    "title": "6  Domain Logic Component",
    "section": "6.2 Schemas and Maps",
    "text": "6.2 Schemas and Maps\nThis service takes a standard integration approach to mapping internal and external data structures, this design breaks dependencies so that the external interface may change without affecting internal systems.\nObjects received from interfaces should follow a standard VETER integration pattern (Validate, Extract, Transform, Enrich, Route)\n\nValidate\n\nObjects should be validated and a default rules set should be applied to validate the object.\n\nExtract\n\nExtract specific information from the message, such as audit etc.\n\nTransForm\n\nThe Message should be transformed into the next type in the process.\n\nEnrich\n\nAdds additional data to the message, often from external sources\n\nRoute\n\nDirects the processed message to the appropriate destination based on certain criteria.",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Domain Logic Component</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/domain-logic-component/index.html#brochure-generation",
    "href": "Book/building-block-view/domain-logic-component/index.html#brochure-generation",
    "title": "6  Domain Logic Component",
    "section": "6.3 Brochure Generation",
    "text": "6.3 Brochure Generation\n\n6.3.1 Request Schema\n\n\n\n6.3.2 Validation Rules\n\nGiven : A Brochure Generation Request\nWhen : ID is a GUID\nAND : Audit Is Valid\n\nSourceApp is not Null\nUser is not Null\nhost is not Null\nTimeStamp is valid today, current hour\n\nAND : Request is Valid\n\nExternalId is not Null, GUID\nBespoke is True or False\nTemplateId is Frontify Id\nBrochure array is Valid\n\nArray of Key/Type/Value tuples\n\n\nThen : I can generate a brochure\n\n\n\n6.3.3 Response Schema",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Domain Logic Component</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/security-component/index.html",
    "href": "Book/building-block-view/security-component/index.html",
    "title": "7  Security Component",
    "section": "",
    "text": "7.1 Managed Identity\nThe Header of any incoming message will contain 2 header keys IDENTITY_ENDPOINT and IDENTITY_HEADER they sometimes appear under there alias names MSI_ENDPOINT and MSI_HEADER.",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Security Component</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/security-component/index.html#managed-identity",
    "href": "Book/building-block-view/security-component/index.html#managed-identity",
    "title": "7  Security Component",
    "section": "",
    "text": "7.1.1 Retrieve the MI token\nUse the DefaultAzureCredential to obtain the token for the managed identity.\nvar credential = new DefaultAzureCredential();\nvar token = await credential.GetTokenAsync(new TokenRequestContext(new[] { \"https://management.azure.com/.default\" }));\n\n\n7.1.2 Validate the token\nUse the Microsoft.IdentityModel.Tokens library to validate the token. This involves checking the token’s signature, issuer, audience, and expiration.\nusing Microsoft.IdentityModel.Tokens;\nusing System.IdentityModel.Tokens.Jwt;\n\npublic bool ValidateToken(string token)\n{\n    var tokenHandler = new JwtSecurityTokenHandler();\n    var validationParameters = new TokenValidationParameters\n    {\n        ValidateIssuer = true,\n        ValidIssuer = \"https://sts.windows.net/{tenant-id}/\",\n        ValidateAudience = true,\n        ValidAudience = \"https://management.azure.com/\",\n        ValidateLifetime = true,\n        IssuerSigningKeyResolver = (token, securityToken, kid, parameters) =&gt;\n        {\n            // Retrieve signing keys from Azure AD\n            var discoveryDocument = \"https://login.microsoftonline.com/{tenant-id}/v2.0/.well-known/openid-configuration\";\n            var keys = new JsonWebKeySet(discoveryDocument).GetSigningKeys();\n            return keys;\n        }\n    };\n\n    try\n    {\n        tokenHandler.ValidateToken(token, validationParameters, out SecurityToken validatedToken);\n        return true;\n    }\n    catch\n    {\n        return false;\n    }\n}\n\n\n7.1.3 Authorise the caller\nEnsure the caller’s managed identity has the necessary permissions to access the function. This can be done by checking the claims in the token.\nvar jwtToken = tokenHandler.ReadJwtToken(token);\nvar claims = jwtToken.Claims;\n\n// Check for specific roles or permissions\nvar hasAccess = claims.Any(c =&gt; c.Type == \"roles\" && c.Value == \"YourRequiredRole\");\n\n\n7.1.4 Function Code\nBy combining the above snippets, you would be able to check and authorise the calling application.\npublic static async Task&lt;IActionResult&gt; Run(HttpRequest req, ILogger log)\n{\n    var token = req.Headers[\"Authorization\"].ToString().Replace(\"Bearer \", \"\");\n    if (!ValidateToken(token))\n    {\n        return new UnauthorizedResult();\n    }\n\n    // Proceed with your function logic\n    return new OkResult();\n}",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Security Component</span>"
    ]
  },
  {
    "objectID": "Book/building-block-view/security-component/index.html#user-authentication",
    "href": "Book/building-block-view/security-component/index.html#user-authentication",
    "title": "7  Security Component",
    "section": "7.2 User Authentication",
    "text": "7.2 User Authentication\nN.B. If a User token is included in the header then check the user is authorised.\nUse the Microsoft.Identity.Web library to handle authentication and authorization in your function.\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.Azure.WebJobs;\nusing Microsoft.Azure.WebJobs.Extensions.Http;\nusing Microsoft.AspNetCore.Http;\nusing Microsoft.Extensions.Logging;\nusing Microsoft.Identity.Web;\nusing System.Threading.Tasks;\n\npublic static class MyFunction\n{\n    [FunctionName(\"MyFunction\")]\n    public static async Task&lt;IActionResult&gt; Run(\n        [HttpTrigger(AuthorizationLevel.Function, \"get\", \"post\", Route = null)] HttpRequest req,\n        ILogger log)\n    {\n        var user = req.HttpContext.User;\n\n        if (!user.Identity.IsAuthenticated)\n        {\n            return new UnauthorizedResult();\n        }\n\n        // Check for specific roles or claims\n        if (!user.IsInRole(\"YourRequiredRole\"))\n        {\n            return new ForbidResult();\n        }\n\n        // Proceed with your function logic\n        return new OkObjectResult(\"User is authorized\");\n    }\n}",
    "crumbs": [
      "Building Block View",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Security Component</span>"
    ]
  },
  {
    "objectID": "Book/solution-strategy/index.html",
    "href": "Book/solution-strategy/index.html",
    "title": "8  Solution Strategy",
    "section": "",
    "text": "This solution follows the rules laid out in previous pattern architecture documents.\n\n\n\nDocument\nLink\n\n\n\n\nThird Party Integration\nLink\n\n\nManaged Identities\nLink\n\n\nAPIM\nLink\n\n\nWebHooks\nLink\n\n\nAzure Functions\nLink\n\n\nTenant, Subscribers and Resource Groups\nLink",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Solution Strategy</span>"
    ]
  },
  {
    "objectID": "Book/runtime-view/index.html",
    "href": "Book/runtime-view/index.html",
    "title": "9  Runtime View",
    "section": "",
    "text": "9.1 Overview\nThis shows the general flow of how the system will function.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Runtime View</span>"
    ]
  },
  {
    "objectID": "Book/runtime-view/index.html#overview",
    "href": "Book/runtime-view/index.html#overview",
    "title": "9  Runtime View",
    "section": "",
    "text": "The selects if they want to generate a Bespoke or a Auto Generated brochure.\nThe service will make a Get Template request to Frontify, and filter the list to only those templates that are either the CSV or the Auto Generation brochure types.\nThe Get Templates method will return the template name and its detail.\nHub will create a service request object, and map the text and image artifacts to the template detail Keys.\nHub publishes the Brochure Generation request to the service bus.\nThe service picks up the brochure generation request, and creates a brochure object in the datastore.\nIf the User requested a Bespoke brochure then\n\nA CSV file is created.\nAll of the image objects from the existing request brochure object are loaded into frontify and Assets are created.\nThe Text and Asset Id’s are written to the CSV.\nA request is made to the datastore to return all incomplete brochure objects.\nCSV rows are created for each.\nThe CSV is uploaded.\nOnce the Brochure has been created by the Frontify User, They will need to login to Hub and Upload the brochure, and indicate the generation is complete.\n\nHub will inform the service that the brochure is complete.\nThe service will complete the message in the datastore, stopping its inclusion in future CSV files.\n\n\nIf the User requested a Auto Generation Brochure then\n\nA Export Creative request is generated\nEither Poll Or Wait for a Webhook, which will indicate the generation is complete.\nSave the brochure in the Document Manager.\nCreate a response message, and publish it onto the service bus.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Runtime View</span>"
    ]
  },
  {
    "objectID": "Book/deployment-view/index.html",
    "href": "Book/deployment-view/index.html",
    "title": "10  Deployment View",
    "section": "",
    "text": "10.1 Security\nThe application is accessed by Internal web applications.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Deployment View</span>"
    ]
  },
  {
    "objectID": "Book/deployment-view/index.html#security",
    "href": "Book/deployment-view/index.html#security",
    "title": "10  Deployment View",
    "section": "",
    "text": "Internal are within the companies network.\nNot accessible from the public internet.\nManaged Identity will be used between APIM and the Azure Function Service.\nThe Azure Function will validate the MI token.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Deployment View</span>"
    ]
  },
  {
    "objectID": "Book/deployment-view/index.html#application",
    "href": "Book/deployment-view/index.html#application",
    "title": "10  Deployment View",
    "section": "10.2 Application",
    "text": "10.2 Application\n\nThe Application resource group will contain the usual components for a microservice.\nThe components will follow our naming convention.\n\n\n\n\n\n\n\n\n\nComponent\nName\n\n\n\n\n\nAzure Function\nfunc-frontify-env-ne\n\n\n\nApplication Insights\nappi-frontify-env-ne\n\n\n\nStorage Account\nstfrontifyEnvNe\nCamelcase for readability, should be lowercase\n\n\nKey Vault\nkey-frontify-env-ne\n\n\n\n\nN.B. Env should be changed to match the deployment environment.\nThe Application will be registered in Active Directory (Entra).",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Deployment View</span>"
    ]
  },
  {
    "objectID": "Book/deployment-view/index.html#datastore.",
    "href": "Book/deployment-view/index.html#datastore.",
    "title": "10  Deployment View",
    "section": "10.3 DataStore.",
    "text": "10.3 DataStore.\n\nThe application uses a Cosmos Database as its data store.\nA new cosmos DB container of NOSQL type should be set up.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Deployment View</span>"
    ]
  }
]